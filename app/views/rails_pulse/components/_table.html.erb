<%
  # Extract the table data from the arguments
  table_data = defined?(table_data) ? table_data : (defined?(data) ? data : {})

  # Handle both old format (array) and new format (hash with columns and data)
  if table_data.is_a?(Array)
    # Legacy format - assume route data
    columns = [
      { field: :route_path, label: 'Route' },
      { field: :this_week_avg, label: 'This Week Avg (ms)', highlight: :trend },
      { field: :last_week_avg, label: 'Last Week Avg (ms)' },
      { field: :percentage_change, label: 'Change', format: :percentage, highlight: :percentage_change },
      { field: :request_count, label: 'Requests' }
    ]
    data_rows = table_data
  else
    # New format - dynamic columns and data
    columns = table_data[:columns] || []
    data_rows = table_data[:data] || []
  end

  colspan = columns.length
%>

<table class="table mbs-4" style="table-layout: fixed;">
  <thead>
    <tr>
      <% columns.each do |column| %>
        <th class="<%= column[:class] %>" <%= "style=\"width: #{column[:width]};\"".html_safe if column[:width] %>><%= column[:label] %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% if data_rows.any? %>
      <% data_rows.each do |row_data| %>
        <tr>
          <% columns.each do |column| %>
            <td class="<%= column[:cell_class] %> <%= cell_highlight_class(row_data, column) %>" <%= "style=\"max-width: #{column[:width]}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\"".html_safe if column[:width] %>>
              <%= render_cell_content(row_data, column) %>
            </td>
          <% end %>
        </tr>
      <% end %>
    <% else %>
      <tr>
        <td colspan="<%= colspan %>" class="text-center text-subtle">No data available for the selected time period</td>
      </tr>
    <% end %>
  </tbody>
</table>
